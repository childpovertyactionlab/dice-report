---
title: "Photo Gallery"
format: html
---
```{r include=FALSE}
library(ggplot2)
library(cpaltemplates)
library(tidyverse)
library(readr)
library(bslib)
library(bsicons)
library(sf)
library(highcharter)
library(geojsonsf)
library(geojsonio)
library(googlesheets4)
library(leaflet)
##### Map Data #####
myhcmap <- st_read("data/dpd_divisions.geojson")

geojson <- geojson_json(myhcmap)

sw_boundaries <- myhcmap %>% 
  filter(DIVISION == "SOUTHWEST")

sw_geojson <- geojson_json(sw_boundaries)

geojson_sf <- st_read("data/dpd_divisions.geojson")

##### Data #####
gs4_deauth()
impact <- read_sheet("https://docs.google.com/spreadsheets/d/1TInROva7mCNM7qvTA-6GFrkA4zIHcYNpy2eGhsgyg-8/edit#gid=0")

current_date <- Sys.Date()

impact$date <- ymd(impact$date)

impact <- impact |> 
  mutate(
    month = floor_date(date, "month"),
    formatted_month = format(month, "%B, %Y")
  ) |>
  filter(date < current_date)

impact$lbs_produce <- impact$bags * 10

sw_impact <- impact |>
 filter(district == "South West")

total_lbs_trash <- sum(sw_impact$lbs_trash, na.rm = TRUE)

total_bags <- sum(sw_impact$bags, na.rm = TRUE)
cumulative_lbs_produce <- cumsum(sw_impact$lbs_produce)

monthly_average_people_served <- sw_impact %>%
  filter(people_served != 0) %>%
  pull(people_served) %>%
  mean(na.rm = TRUE) %>%
  round()

trash_data <- sw_impact %>%
  select(formatted_month, lbs_trash) %>%
  filter(lbs_trash != 0) %>%
  group_by(formatted_month) %>%
  summarise(monthly_lbs_trash = sum(lbs_trash)) |> 
  mutate(cumulative_lbs_trash = cumsum(monthly_lbs_trash))

produce_data <- sw_impact %>%
  select(formatted_month, lbs_produce) %>%
  filter(lbs_produce != 0) %>%
  group_by(formatted_month) %>%
  summarise(monthly_lbs_produce = sum(lbs_produce)) |> 
  mutate(cumulative_lbs_produce = cumsum(monthly_lbs_produce))

people_served_data <- sw_impact %>%
  select(formatted_month, people_served) %>%
  filter(people_served != 0) %>%
  group_by(formatted_month) %>%
  summarise(monthly_people_served = sum(people_served))
```
```{=html}

<style>
  /* Custom CSS for smaller images */
  .small-image {
    max-height: 50px; /* Adjust the maximum height as needed */
  }

  /* Custom CSS for medium images */
  .medium-image {
    max-height: 250px; /* Adjust the maximum height as needed */
  }

  /* Hidden class */
  .hidden {
    display: none;
  }

  /* Main image container */
  .main-image-container {
    position: relative;
    display: inline-block;
    border: 5px solid #008097;
    padding: 5px;
    margin: 20px;
  }

  /* Label for the main image */
  .image-label {
    position: absolute;
    top: 80px;
    left: 0;
    width: 100%;
    text-align: center;
    font-weight: bold;
    color: #008097;
    font-size: 12px;
    background-color: white;
  }
</style>
```
::: Grid
## Produce Drives

Elit eget gravida cum sociis natoque penatibus et magnis. Sed enim ut sem viverra aliquet eget sit amet tellus. Egestas erat imperdiet sed euismod nisi porta. Nulla porttitor massa id neque aliquam vestibulum morbi blandit. Facilisi cras fermentum odio eu feugiat pretium nibh ipsum. Eget est lorem ipsum dolor sit amet consectetur adipiscing elit. Tellus in hac habitasse platea dictumst vestibulum rhoncus. Nec feugiat in fermentum posuere. Sit amet mauris commodo quis.
:::
::: grid
::: g-col-6
```{r}
leaflet() %>%
  addTiles() %>%
  setView(lng = -96.9038734161504, lat = 32.7054543930708, zoom = 13) 
```
:::

::: g-col-6
```{r}
highchart() %>%
  hc_chart(type = "line") %>%
  hc_xAxis(categories = trash_data$formatted_month) %>%
  hc_yAxis(min = 0) %>% 
  hc_add_series(data = trash_data$cumulative_lbs_trash, name = "Pounds", x = trash_data$formatted_month) %>%
  hc_title(text = "Pounds of Trash Collected by DICE") %>%
  hc_tooltip(pointFormat = "{series.name}: {point.y:.2f}") %>%
  hc_colors(palette_cpal_main) %>%
  hc_plotOptions(series = list(
    lineWidth = 4,  
    marker = list(
      enabled = TRUE,
      symbol = "circle", 
      radius = 6,         
      fillColor = NULL,   
      lineWidth = 2,
      lineColor = NULL    
    )
  )) %>%
  hc_legend(enabled = FALSE)
```
:::
:::

::: Grid
::: g-col-6
```{r}
highchart(type = "map") %>%
   hc_chart(height = 300) %>%
  hc_add_series(mapData = geojson, showInLegend = FALSE) %>%
  hc_add_series(data = sw_boundaries, mapData = geojson, 
                joinBy = "DIVISION", name = "South West Division", 
                color = "#008097", showInLegend = FALSE,
                dataLabels = list(enabled = FALSE, format = '{point.DIVISION}'),
                tooltip = list(enabled = TRUE)) %>%
  hc_mapNavigation(enabled = FALSE)

```
:::
::: g-col-6
```{r}
highchart() %>%
  hc_chart(type = "line") %>%
  hc_xAxis(categories = trash_data$formatted_month) %>%
  hc_yAxis(min = 0) %>% 
  hc_add_series(data = trash_data$cumulative_lbs_trash, name = "Pounds", x = trash_data$formatted_month) %>%
  hc_title(text = "Pounds of Trash Collected by DICE") %>%
  hc_tooltip(pointFormat = "{series.name}: {point.y:.2f}") %>%
  hc_colors(palette_cpal_main) %>%
  hc_plotOptions(series = list(
    lineWidth = 4,  
    marker = list(
      enabled = TRUE,
      symbol = "circle", 
      radius = 6,         
      fillColor = NULL,   
      lineWidth = 2,
      lineColor = NULL    
    )
  )) %>%
  hc_legend(enabled = FALSE)
```

```
:::
:::
